(()=>{var e={108:(e,t,o)=>{var r=o(464),s=o(84);function n(){return(new Date).getTime()}var i,u=Array.prototype.slice,a={};i="undefined"!=typeof global&&global.console?global.console:"undefined"!=typeof window&&window.console?window.console:{};for(var c=[[function(){},"log"],[function(){i.log.apply(i,arguments)},"info"],[function(){i.log.apply(i,arguments)},"warn"],[function(){i.warn.apply(i,arguments)},"error"],[function(e){a[e]=n()},"time"],[function(e){var t=a[e];if(!t)throw new Error("No such label: "+e);delete a[e];var o=n()-t;i.log(e+": "+o+"ms")},"timeEnd"],[function(){var e=new Error;e.name="Trace",e.message=r.format.apply(null,arguments),i.error(e.stack)},"trace"],[function(e){i.log(r.inspect(e)+"\n")},"dir"],[function(e){if(!e){var t=u.call(arguments,1);s.ok(!1,r.format.apply(null,t))}},"assert"]],d=0;d<c.length;d++){var l=c[d],f=l[0],p=l[1];i[p]||(i[p]=f)}e.exports=i},607:function(e,t,o){"use strict";var r=o(108),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(o(406)),i=s(o(97)),u=s(o(17)),a=s(o(731)),c=s(o(4)),d=s(o(440)),l=o(135),f=s(o(645)),p=new n.default;p.use((0,i.default)(u.default.join(__dirname,"./static"))),p.use((0,c.default)({multipart:!0,formidable:{keepExtensions:!0}})),p.use((0,a.default)()),p.use((0,l.response)()).use((0,l.fail)()),p.use(d.default.routes()),d.default.allowedMethods({throw:!0}),p.listen(f.default.port,(()=>{r.log(`服务启动！端口是${f.default.port}`)}))},191:function(e,t,o){"use strict";const r=(this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}})(o(645)),s=o(629),n=r.default.mongoDB,i=n.user,u=[`mongodb://${s.tools.decrypt(n.user_name[i])}:${s.tools.decrypt(n.password)}@${r.default.host}:${n.dbHost}/${n.dataBase}`,`mongodb+srv://photo_base:${s.tools.decrypt(n.password)}@cluster0.uk7mxbo.mongodb.net/${n.dataBase}`];e.exports={server:u[i],rules:n.rules}},345:function(e,t,o){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.blog=void 0;const s=o(140),n=o(629),i=r(o(645)),u=new s.Schema({author:{type:Number,ref:`${n.tools.getConfig().name}_user_info`},title:String,content:String,image:[],create_time:{type:String,default:Date}});u.statics.findby;const a=`${i.default.name}_blog`;t.blog=s.model(a,u,a)},354:function(e,t,o){"use strict";var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(s,n){function i(e){try{a(r.next(e))}catch(e){n(e)}}function u(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,u)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.BLOG=void 0;const s=o(345);t.BLOG=class{static createBlog(e,t){return r(this,void 0,void 0,(function*(){try{const t=yield s.blog.create(Object.assign({},e.request.body));e.success("创建成功",t)}catch(t){e.fail(t.message)}}))}static userBlog(e){return r(this,void 0,void 0,(function*(){let t=e.request.body;const o=yield s.blog.find(t).populate({path:"author",select:["name","phone"]});e.success("查找成功",o)}))}}},332:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uploadLog=void 0;const r=o(140),{tools:s}=o(629),n=new r.Schema({user:String,source_version:{type:Number,default:s._version()},file_size:String,img:String,date:String,status:String}),i=`${s.getConfig().name}_upload_log`;t.uploadLog=r.model(i,n,i)},557:function(e,t,o){"use strict";var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(s,n){function i(e){try{a(r.next(e))}catch(e){n(e)}}function u(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,u)}a((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UPLOAD=void 0;const n=o(629),i=s(o(147)),u=o(332),a=s(o(645)),c=o(426);t.UPLOAD=class{static upload(e){return r(this,void 0,void 0,(function*(){let t=e.request.body;if(!t.user_id)return void e.fail("请先登录");if(!(yield(0,c.findUser)({_id:t.user_id})))return void e.fail("用户不存在");i.default.existsSync("static")||i.default.mkdirSync("static");let o=`static/upload/${t.folder}`;const s=t=>new Promise(((o,r)=>{i.default.exists(t,(r=>{if(r)o(!0);else{try{i.default.mkdirSync(t)}catch(o){e.fail(t+"创建失败")}o(!0)}}))})),d=()=>new Promise(((e,t)=>{i.default.exists(o,(t=>r(this,void 0,void 0,(function*(){if(t)e(!0);else{let t=o.split("/"),r=t[0];for(let o=0;o<t.length;o++)o>0&&(r=`${r}/${t[o]}`,yield s(r),o==t.length-1&&e(!0))}}))))}));try{yield d();const r=e.request.files.file,s=i.default.createReadStream(r.path),c=`${o}/${r.name}`,l=i.default.createWriteStream(c),f=()=>new Promise(((e,t)=>{s.pipe(l),e(!0)})),p={user:t.user_id,status:"上传成功",file_size:r.size<1e6?(r.size/1e3).toFixed(2)+"KB":(r.size/1e3/1e3).toFixed(2)+"MB",date:n.tools.date(),img:`http://${a.default.localHost}:${a.default.port}/upload/${t.folder}/${r.name}`};yield f(),yield u.uploadLog.create(p),e.success("上传成功",p)}catch(t){e.fail(501,"上传失败",t)}}))}}},778:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TOOLS=void 0;const r=o(629);t.TOOLS=class{static encryption(e){const t=e.request.url.split("/api/encryption?msg=")[1];e.body=r.tools.encryption(t)}static decrypt(e){const t=e.request.url.split("/api/decrypt?msg=")[1];e.body=r.tools.decrypt(t)}}},426:function(e,t,o){"use strict";var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(s,n){function i(e){try{a(r.next(e))}catch(e){n(e)}}function u(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,u)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.USER=t.findUser=void 0;const s=o(376),n=o(629);t.findUser=e=>r(void 0,void 0,void 0,(function*(){return(yield s.user.find(e)).length>0})),t.USER=class{static createUserInfo(e,o){return r(this,void 0,void 0,(function*(){let o=e.request.body;o.password=n.tools.encryption(o.password);try{if(yield(0,t.findUser)({phone:o.phone}))e.success("用户已存在");else{let t=Number(String(o.phone).substring(7,11)+Math.floor(9999*Math.random()));const r=yield s.user.create(Object.assign(Object.assign({},o),{_id:t}));yield s.user_p.create(Object.assign(Object.assign({},o),{userInfo:r._id,id:t})),e.success("创建成功",r)}}catch(t){e.fail(t.message)}}))}static login(e,o){return r(this,void 0,void 0,(function*(){let o=e.request.body,r={phone:Number(o.user)},i={_id:Number(o.user)};try{if(11==o.user.length){if(yield(0,t.findUser)(r)){const t=yield s.user_p.findOne(r).populate("userInfo"),i=t.password;return void(o.password==n.tools.decrypt(i)?e.success("登陆成功",t.userInfo):e.success("密码错误"))}return void e.success("手机号未注册")}if(yield(0,t.findUser)(i)){const t=yield s.user_p.findOne({userInfo:o.user}).populate("userInfo"),r=t.password;o.password==n.tools.decrypt(r)?e.success("登陆成功",t.userInfo):e.success("密码错误")}else e.success("用户ID不存在")}catch(t){e.fail(t.message)}}))}static deleteUserInfo(e,t){return r(this,void 0,void 0,(function*(){try{yield s.user.deleteOne({age:1}),e.body="删除成功"}catch(t){e.body="删除失败"}}))}static updateUserInfo(e,t){return r(this,void 0,void 0,(function*(){const t=e.request.body;let o={};t.name&&(o={name:t.name}),t.head_url&&(o={head_url:t.head_url}),t.sex&&(o={sex:t.sex}),t.phone&&(o={phone:t.phone});try{const r=yield s.user.findOne({_id:Number(t.user_id)});r.set(o),r.save(),e.success("更新成功",r)}catch(t){e.fail(t)}}))}static getUserInfo(e,t){return r(this,void 0,void 0,(function*(){try{const t=yield s.user.find({});e.success("请求成功",t)}catch(t){e.fail(t.message)}}))}}},376:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.user_p=t.user=void 0;const r=o(140),{tools:s}=o(629),n=new r.Schema({_id:Number,name:{type:String,required:[!0,"昵称为必填字段"],maxLength:10,minLength:2,trim:!0},phone:{type:Number,required:[!0,"手机号为必填字段"],minLength:11,maxLength:11,trim:!0},sex:{type:Number,required:!1,enmu:[0,1,2],default:0},age:{type:Number,min:1,max:150},head_url:{type:String},create_params:{version:{type:String,default:s.version()},source_version:{type:String,default:s._version()},time:{type:String,default:s.date()},source_time:{type:String,default:Date.now()}}}),i=new r.Schema({userInfo:{type:Number,ref:`${s.getConfig().name}_user_info`},id:{type:Number},phone:{type:Number,required:[!0,"手机号为必填字段"],minLength:11,maxLength:11,trim:!0},password:{type:String,required:[!0,"密码为必填字段"],trim:!0},__v:{type:String,defalut:s._version()}}),u=`${s.getConfig().name}_user_info_p`,a=`${s.getConfig().name}_user_info`,c=r.model(a,n,a);t.user=c;const d=r.model(u,i,u);t.user_p=d},140:(e,t,o)=>{"use strict";var r=o(108);const s=o(185),{server:n,rules:i,mongoDB:u}=o(191);s.connect(n,i).then((()=>{r.log("链接成功")})).catch((e=>{r.log("链接失败",n)})),e.exports=s},440:function(e,t,o){"use strict";var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(s,n){function i(e){try{a(r.next(e))}catch(e){n(e)}}function u(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,u)}a((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=new(s(o(752)).default)({prefix:"/api"}),i=o(426),u=o(557),a=o(778),c=o(354);n.get("/getUserInfo",i.USER.getUserInfo).post("/createUserInfo",i.USER.createUserInfo).post("/update",i.USER.updateUserInfo).post("/delete",i.USER.deleteUserInfo).post("/login",i.USER.login).post("/updateUserInfo",i.USER.updateUserInfo).post("/upload",u.UPLOAD.upload).get("/encryption",a.TOOLS.encryption).get("/decrypt",a.TOOLS.decrypt).post("/createBlog",c.BLOG.createBlog).post("/userBlog",c.BLOG.userBlog).get("/",(e=>r(void 0,void 0,void 0,(function*(){e.body="DANKEBIBI"})))),t.default=n},135:function(e,t){"use strict";var o=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(s,n){function i(e){try{a(r.next(e))}catch(e){n(e)}}function u(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,u)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.fail=t.response=void 0,t.response=()=>(e,t)=>o(void 0,void 0,void 0,(function*(){e.success=(t,o)=>{e.response.status=200,e.body={code:1,message:t,data:o}},e.fail=(t,o)=>{e.response.status=o||501,e.body={code:0,message:t}},yield t()})),t.fail=()=>(e,t)=>o(void 0,void 0,void 0,(function*(){try{e.body||(e.body={code:404,message:"by DANKEBIBI @ node-api-server 服务"}),yield t()}catch(t){e.body={code:504,message:"请求出错"},e.status=504}}))},645:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={projectName:"photo_base",name:"pb",host:"47.115.218.121",localHost:"127.0.0.1",port:8080,version:"1.0.1",mongoDB:{user:0,user_name:["ggDKEllDKEllDKEiiDKE157DKE988","iiDKEvvDKEeeDKEiiDKEvvDKEhhDKE-DKEwwDKEkkDKE494DKE955"],password:"2153604DKE717868DKE1794670DKE0DKEvvDKEppDKEmmDKEzzDKEWWDKE911DKE394",dbHost:"27017",dataBase:"photo_base",rules:{useNewUrlParser:!0,useUnifiedTopology:!0,authSource:"admin"}}}},311:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatString=void 0,t.formatString=e=>({a:"ZZ",b:"YY",c:"XX",d:"WW",e:"VV",f:"UU",g:"TT",h:"SS",i:"RR",j:"QQ",k:"PP",l:"OO",m:"NN",n:"MM",o:"LL",p:"KK",q:"JJ",r:"II",s:"HH",t:"GG",u:"FF",v:"EE",w:"DD",x:"CC",y:"BB",z:"AA",A:"zz",B:"yy",C:"xx",D:"ww",E:"vv",F:"uu",G:"tt",H:"ss",I:"rr",J:"qq",K:"pp",L:"oo",M:"nn",N:"mm",O:"ll",P:"kk",Q:"jj",R:"ii",S:"hh",T:"gg",U:"ff",V:"ee",W:"dd",X:"cc",Y:"bb",Z:"aa",ZZ:"a",YY:"b",XX:"c",WW:"d",VV:"e",UU:"f",TT:"g",SS:"h",RR:"i",QQ:"j",PP:"k",OO:"l",NN:"m",MM:"n",LL:"o",KK:"p",JJ:"q",II:"r",HH:"s",GG:"t",FF:"u",EE:"v",DD:"w",CC:"x",BB:"y",AA:"z",zz:"A",yy:"B",xx:"C",ww:"D",vv:"E",uu:"F",tt:"G",ss:"H",rr:"I",qq:"J",pp:"K",oo:"L",nn:"M",mm:"N",ll:"O",kk:"P",jj:"Q",ii:"R",hh:"S",gg:"T",ff:"U",ee:"V",dd:"W",cc:"X",bb:"Y",aa:"Z"}[e])},629:function(e,t,o){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.tools=void 0;const s=r(o(645)),n=o(311);t.tools=class{static date(){const e=new Date;return`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}  ${e.getHours()}:${e.getMinutes()}:${e.getSeconds()}`}static version(){return s.default.version}static _version(){return s.default.version.replace(/\./gm,"")}static encryption(e){const t=Math.floor(999*Math.random()),o=Math.floor(999*Math.random());return(e=>{let r=e.split(""),s=r.reverse();return s.forEach(((e,r)=>{e>=0&&(s[r]=String(e*t*o)),/^[a-z]*$/g.test(e)&&(s[r]=(0,n.formatString)(e.toUpperCase())),/^[A-Z]*$/g.test(e)&&(s[r]=(0,n.formatString)(e.toLowerCase())),"%"==e&&(s[r]="DKEBIBI")})),r.push(String(t)),r.push(String(o)),s.join("DKE")})(e)}static decrypt(e){return(t=>{let o=e.split("DKE").reverse();return o.forEach(((e,t)=>{t>1&&(e>=0&&(o[t]=String(e/o[0]/o[1])),/^[a-z]*$/g.test(e)&&(o[t]=(0,n.formatString)(e.toUpperCase())),/^[A-Z]*$/g.test(e)&&(o[t]=(0,n.formatString)(e.toLowerCase())),"DKEBIBI"==e&&(o[t]=""))})),o.splice(0,2),o.join("")})()}static getConfig(){return s.default}}},84:e=>{"use strict";e.exports=require("assert")},406:e=>{"use strict";e.exports=require("koa")},4:e=>{"use strict";e.exports=require("koa-body")},731:e=>{"use strict";e.exports=require("koa-cors")},752:e=>{"use strict";e.exports=require("koa-router")},97:e=>{"use strict";e.exports=require("koa-static")},185:e=>{"use strict";e.exports=require("mongoose")},464:e=>{"use strict";e.exports=require("util")},147:e=>{"use strict";e.exports=require("fs")},17:e=>{"use strict";e.exports=require("path")}},t={};!function o(r){var s=t[r];if(void 0!==s)return s.exports;var n=t[r]={exports:{}};return e[r].call(n.exports,n,n.exports,o),n.exports}(607)})();